{
  "$schema": "http://json-schema.org/schema#",
  "definitions": {
    "Node": {
      "type": "object",
      "properties": {
        "type": { "type": "string" },
        "loc": {
          "oneOf": [
            { "$ref": "#/definitions/SourceLocation" },
            { "type": "null" }
          ]
        }
      },
      "required": [ "type" ]
    },
    "SourceLocation": {
      "type": "object",
      "properties": {
        "source": {
          "oneOf": [
            { "type": "string" },
            { "type": "null" }
          ]
        },
        "start": {
          "allOf": [
            { "$ref": "#/definitions/Position" }
          ]
        },
        "end": {
          "allOf": [
            { "$ref": "#/definitions/Position" }
          ]
        }
      },
      "required": [ "start", "end" ]
    },
    "Position": {
      "type": "object",
      "properties": {
        "line": { "type": "integer", "minimum": 1 },
        "column": { "type": "integer", "minimum": 0 }
      },
      "required": [ "line", "column" ]
    },
    "Program": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/Node" }
      ],
      "properties": {
        "type": { "type": "string", "pattern": "^Program$" },
        "body": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Statement"
          }
        }
      },
      "required": [ "body" ]
    },
    "Function": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/Node" }
      ],
      "properties": {
        "id": {
          "oneOf": [
            { "$ref": "#/definitions/Identifier" },
            { "type": "null" }
          ]
        },
        "params": {
          "type": "array",
          "items": { "$ref": "#/definitions/Pattern" }
        },
        "defaults": {
          "type": "array",
          "items": { "$ref": "#/definitions/Expression" }
        },
        "rest": {
          "oneOf": [
            { "$ref": "#/definitions/Identifier" },
            { "type": "null" }
          ]
        },
        "body": {
          "oneOf": [
            { "$ref": "#/definitions/BlockStatement" },
            { "$ref": "#/definitions/Expression" }
          ]
        },
        "generator": {
          "type": "boolean"
        },
        "expression": {
          "type": "boolean"
        }
      },
      "required": [ 
        "id", "params", "defaults", "rest", "body", "generator", "expression" 
      ]
    },
    "_Statement": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/Node" }
      ]
    },
    "Statement": {
      "type": "object",
      "oneOf": [
        { "$ref": "#/definitions/EmptyStatement" },
        { "$ref": "#/definitions/BlockStatement" },
        { "$ref": "#/definitions/ExpressionStatement" },
        { "$ref": "#/definitions/IfStatement" },
        { "$ref": "#/definitions/LabeledStatement" },
        { "$ref": "#/definitions/BreakStatement" },
        { "$ref": "#/definitions/ForStatement" },
        { "$ref": "#/definitions/Declaration" }
      ]
    },
    "EmptyStatement": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/_Statement" }
      ],
      "properties": {
        "type": { "type": "string", "pattern": "^EmptyStatement$" }
      }
    },
    "BlockStatement": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/_Statement" }
      ],
      "properties": {
        "type": { "type": "string", "pattern": "^BlockStatement$" },
        "body": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Statement"
          }
        }
      },
      "required": [ "body" ]
    },
    "ExpressionStatement": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/_Statement" }
      ],
      "properties": {
        "type": { "type": "string", "pattern": "^ExpressionStatement$" },
        "expression": {
          "$ref": "#/definitions/Expression"
        }
      },
      "required": [ "expression" ]
    },
    "IfStatement": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/_Statement" }
      ],
      "properties": {
        "type": { "type": "string", "pattern": "^IfStatement$" },
        "test": { "$ref": "#/definitions/Expression" },
        "consequent": { "$ref": "#/definitions/Statement" },
        "alternate": {
          "oneOf": [
            { "$ref": "#/definitions/Statement" },
            { "type": "null" }
          ]
        }
      },
      "required": [ "test", "consequent", "alternate" ]
    },
    "LabeledStatement": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/_Statement" }
      ],
      "properties": {
        "type": { "type": "string", "pattern": "^LabeledStatement$" },
        "label": { "$ref": "#/definitions/Identifier" },
        "body": { "$ref": "#/definitions/Statement" }
      },
      "required": [ "label", "body" ]
    },
    "BreakStatement": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/_Statement" }
      ],
      "properties": {
        "type": { "type": "string", "pattern": "^BreakStatement$" },
        "label": {
          "oneOf": [
            { "$ref": "#/definitions/Identifier" },
            { "type": "null" }
          ]
        }
      },
      "required": [ "label" ]
    },
    "ForStatement": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/_Statement" }
      ],
      "properties": {
        "type": { "type": "string", "pattern": "^ForStatement$" },
        "init": {
          "oneOf": [
            { "$ref": "#/definitions/VariableDeclaration" },
            { "$ref": "#/definitions/Expression" },
            { "type": "null" }
          ]
        },
        "test": {
          "oneOf": [
            { "$ref": "#/definitions/Expression" },
            { "type": "null" }
          ]
        },
        "update": {
          "oneOf": [
            { "$ref": "#/definitions/Expression" },
            { "type": "null" }
          ]
        },
        "body": { "$ref": "#/definitions/Statement" }
      },
      "required": [ "init", "test", "update", "body" ]
    },
    "_Declaration": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/Node" }
      ]
    },
    "Declaration": {
      "type": "object",
      "oneOf": [
        { "$ref": "#/definitions/FunctionDeclaration" },
        { "$ref": "#/definitions/VariableDeclaration" }
      ]
    },
    "FunctionDeclaration": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/Function" },
        { "$ref": "#/definitions/_Declaration" }
      ],
      "properties": {
        "type": { "type": "string", "pattern": "^FunctionDeclaration$" },
        "id": { "$ref": "#/definitions/Identifier" }
      },
      "required": [ "id" ]
    },
    "VariableDeclaration": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/_Declaration" }
      ],
      "properties": {
        "type": { "type": "string", "pattern": "^VariableDeclaration$" },
        "declarations": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/VariableDeclarator"
          }
        },
        "kind": {
          "enum": [ "var", "let", "const" ]
        }
      },
      "required": [ "declarations", "kind" ]
    },
    "VariableDeclarator": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/Node" }
      ],
      "properties": {
        "type": { "type": "string", "pattern": "^VariableDeclarator$" },
        "id": { "$ref": "#/definitions/Pattern" },
        "init": { 
          "oneOf": [
            { "$ref": "#/definitions/Expression" },
            { "type": "null" }
          ]
        }
      },
      "required": [ "id", "init" ]
    },
    "_Expression": {
      "allOf": [
        { "$ref": "#/definitions/Node" }
      ]
    },
    "Expression": {
      "type": "object",
      "oneOf": [
        { "$ref": "#/definitions/BinaryExpression" },
        { "$ref": "#/definitions/Identifier" },
        { "$ref": "#/definitions/Literal" }
      ]
    },
    "BinaryExpression": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/_Expression" }
      ],
      "properties": {
        "type": { "type": "string", "pattern": "^BinaryExpression$" },
        "operator": {
          "$ref": "#/definitions/BinaryOperator"
        },
        "left": { "$ref": "#/definitions/Expression" },
        "right": { "$ref": "#/definitions/Expression" }
      },
      "required": [ "operator", "left", "right" ]
    },
    "_Pattern": {
      "allOf": [
        { "$ref": "#/definitions/Node" }
      ]
    },
    "Pattern": {
      "type": "object",
      "oneOf": [
        { "$ref": "#/definitions/Identifier" }
      ]
    },
    "Identifier": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/Node" },
        { "$ref": "#/definitions/_Expression" },
        { "$ref": "#/definitions/_Pattern" }
      ],
      "properties": {
        "type": { "type": "string", "pattern": "^Identifier$" },
        "name": { "type": "string" }
      },
      "required": [ "name" ]
    },
    "Literal": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/Node" },
        { "$ref": "#/definitions/_Expression" }
      ],
      "properties": {
        "type": { "type": "string", "pattern": "^Literal$" },
        "value": {
          "oneOf": [
            { "type": "string" },
            { "type": "boolean" },
            { "type": "null" },
            { "type": "number" },
            { "type": "RegExp" }
          ]
        },
        "raw": {
          "type": "string"
        }
      },
      "required": [ "value", "raw" ]
    },
    "BinaryOperator": {
      "enum": [ 
        "==" , "!=" , "===" , "!==" , "<" , "<=" , ">" , ">=", "<<", ">>", 
        ">>>", "+" , "-" , "*" , "/" , "%" , "|" , "^" , "&" , "in", 
        "instanceof", ".."
      ]
    }
  },
  "type": "object",
  "allOf": [
    { "$ref": "#/definitions/Program" }
  ]
}
