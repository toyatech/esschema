{
  "$schema": "http://json-schema.org/schema#",
  "definitions": {
    "MongooseModule": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/commonjs-module#/definitions/Module" }
      ],
      "properties": {
        "body": {
          "type": "array",
          "items": [
            { 
              "$ref": "http://esschema.org/commonjs-module#/definitions/RequireVariableDeclaration",
              "default": {
                "type": "VariableDeclaration",
                "declarations": [
                  {
                    "type": "VariableDeclarator",
                    "id": {
                      "type": "Identifier",
                      "name": "mongoose"
                    },
                    "init": {
                      "type": "CallExpression",
                      "callee": {
                        "type": "Identifier",
                        "name": "require"
                      },
                      "arguments": [
                        {
                          "type": "Literal",
                          "value": "mongoose"
                        }
                      ]
                    }
                  }
                ],
                "kind": "var"
              }  
            },
            { 
              "$ref": "http://esschema.org/esschema#/definitions/VariableDeclaration",
              "default": {
                "type": "VariableDeclaration",
                "declarations": [
                  {
                    "type": "VariableDeclarator",
                    "id": {
                      "type": "Identifier",
                      "name": "Schema"
                    },
                    "init": {
                      "type": "MemberExpression",
                      "computed": false,
                      "object": {
                        "type": "Identifier",
                        "name": "mongoose"
                      },
                      "property": {
                        "type": "Identifier",
                        "name": "Schema"
                      }
                    }
                  },
                  {
                    "type": "VariableDeclarator",
                    "id": {
                      "type": "Identifier",
                      "name": "Mixed"
                    },
                    "init": {
                      "type": "MemberExpression",
                      "computed": false,
                      "object": {
                        "type": "MemberExpression",
                        "computed": false,
                        "object": {
                          "type": "Identifier",
                          "name": "Schema"
                        },
                        "property": {
                          "type": "Identifier",
                          "name": "Types"
                        }
                      },
                      "property": {
                        "type": "Identifier",
                        "name": "Mixed"
                      }
                    }
                  },
                  {
                    "type": "VariableDeclarator",
                    "id": {
                      "type": "Identifier",
                      "name": "ObjectId"
                    },
                    "init": {
                      "type": "MemberExpression",
                      "computed": false,
                      "object": {
                        "type": "MemberExpression",
                        "computed": false,
                        "object": {
                          "type": "Identifier",
                          "name": "Schema"
                        },
                        "property": {
                          "type": "Identifier",
                          "name": "Types"
                        }
                      },
                      "property": {
                        "type": "Identifier",
                        "name": "ObjectId"
                      }
                    }
                  }
                ],
                "kind": "var"
              }
            }
          ]
        }
      }
    },
    "SchemaIdentifier": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "pattern": "^Schema$", "default": "Schema" }
      }
    },
    "SchemaVariableDeclaration": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/VariableDeclaration" }
      ],
      "properties": {
        "declarations": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/SchemaVariableDeclarator"
          }
        }
      }
    },
    "SchemaVariableDeclarator": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/VariableDeclarator" }
      ],
      "properties": {
        "id": { "$ref": "#/definitions/SchemaInstanceIdentifier" },
        "init": {
        }
      }
    },
    "SchemaInstanceIdentifier": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "pattern": "^schema$", "default": "schema" }
      }
    },
    "SchemaNewExpression": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/NewExpression" }
      ],
      "properties": {
        "callee": {
          "$ref": "#/definitions/SchemaIdentifier"
        },
        "agruments": {
          "type": "array",
          "items": {
          }
        }
      }
    },
    "SchemaObjectExpression": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/ObjectExpression" }
      ],
      "properties": {
        "properties": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/PathProperty"
          }
        }
      }
    },
    "PathProperty": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Property" }
      ],
      "properties": {
        "value": { "$ref": "#/definitions/SchemaTypeObjectExpression" }
      }
    },
    "_SchemaTypeObjectExpression": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/ObjectExpression" }
      ],
      "properties": {
        
    },
    "DefaultProperty": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Property" }
      ],
      "properties": {
        "key": { "$ref": "#/definitions/DefaultIdentifier" }
      }
    },
    "DefaultIdentifier": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "match": "^default$" }
      }
    },
    "IndexProperty": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Property" }
      ],
      "properties": {
        "key": { "$ref": "#/definitions/IndexIdentifier" },
        "value": { "$ref": "#/definitions/BooleanLiteral" }
      }
    },
    "IndexIdentifier": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "match": "^index$" }
      }
    },
    "UniqueProperty": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Property" }
      ],
      "properties": {
        "key": { "$ref": "#/definitions/UniqueIdentifier" },
        "value": { "$ref": "#/definitions/BooleanLiteral" }
      }
    },
    "UniqueIdentifier": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "match": "^unique$" }
      }
    },
    "SparseProperty": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Property" }
      ],
      "properties": {
        "key": { "$ref": "#/definitions/SparseIdentifier" },
        "value": { "$ref": "#/definitions/BooleanLiteral" }
      }
    },
    "SparseIdentifier": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "match": "^sparse$" }
      }
    },
    "SetProperty": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Property" }
      ],
      "properties": {
        "key": { "$ref": "#/definitions/SetIdentifier" },
        "value": { "$ref": "http://esschema.org/esschema#/definitions/FunctionExpression" }
      }
    },
    "SetIdentifier": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "match": "^set$" }
      }
    },
    "GetProperty": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Property" }
      ],
      "properties": {
        "key": { "$ref": "#/definitions/GetIdentifier" },
        "value": { "$ref": "http://esschema.org/esschema#/definitions/FunctionExpression" }
      }
    },
    "GetIdentifier": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "match": "^get$" }
      }
    },
    "ValidateProperty": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Property" }
      ],
      "properties": {
        "key": { "$ref": "#/definitions/ValidateIdentifier" },
        "value": {
          "oneOf": [
            { "$ref": "http://esschema.org/esschema#/definitions/FunctionExpression" },
            { "$ref": "#/definitions/StringLiteral" }
          ]
        }
      }
    },
    "ValidateIdentifier": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "match": "^validate$" }
      }
    },
    "ValidateArrayExpression": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/ArrayExpression" }
      ],
      "properties": {
        "elements": { 
    },
    "ValidatorObjectExpression": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/ObjectExpression" }
      ],
    },
    "RequiredProperty": {
      "allOf": [ 
        { "$ref": "http://esschema.org/esschema#/definitions/Property" }
      ],
      "properties": {
        "key": { "$ref": "#/definitions/RequiredIdentifier" },
        "value": {
          "oneOf": [
            { "$ref": "#/definitions/BooleanLiteral" },
            { "$ref": "#/definitions/StringLiteral" }
          ]
        }
      }
    },
    "RequiredIdentifier": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "match": "^required$" }
      }
    },
    "SchemaTypeObjectExpression": {
      "oneOf": [
        { "$ref": "#/definitions/StringSchemaTypeObjectExpression" },
        { "$ref": "#/definitions/NumberSchemaTypeObjectExpression" },
        { "$ref": "#/definitions/DateSchemaTypeObjectExpression" },
        { "$ref": "#/definitions/BufferSchemaTypeObjectExpression" },
        { "$ref": "#/definitions/BooleanSchemaTypeObjectExpression" },
        { "$ref": "#/definitions/MixedSchemaTypeObjectExpression" },
        { "$ref": "#/definitions/ObjectSchemaTypeObjectExpression" },
        { "$ref": "#/definitions/ArraySchemaTypeObjectExpression" }
      ]
    },
    "StringSchemaTypeObjectExpression": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/_SchemaTypeObjectExpression" }
      ],
      "properties": {
        "properties": {
          "type": "array",
          "items": [
            { "$ref": "#/definitions/StringSchemaTypeProperty" },
            { "$ref": "#/definitions/EnumProperty" },
            { "$ref": "#/definitions/LowercaseProperty" },
            { "$ref": "#/definitions/UppercaseProperty" },
            { "$ref": "#/definitions/TrimProperty" },
            { "$ref": "#/definitions/MatchProperty" },
          ]
        }
      }
    },
    "SchemaTypeProperty": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Property" }
      ],
      "properties": {
        "key": { "$ref": "#/definitions/SchemaTypeIdentifier" }
      }
    },
    "StringSchemaTypeProperty": {
      "type": "object",
      "allOf": [
        { "$ref": "#/definitions/SchemaTypeProperty" }
      ],
      "properties": {
        "value": { "$ref": "#/definitions/StringSchemaTypeIdentifier" }
      }
    },
    "SchemaTypeIdentifier": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "pattern": "^type$" }
      }
    },
    "StringSchemaTypeIdentifier": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "pattern": "^String$" }
      }
    },
    "NumberSchemaTypeIdentifier": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "pattern": "^Number$" }
      }
    },
    "DateSchemaTypeIdentifier": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "pattern": "^Date$" }
      }
    },
    "BufferSchemaTypeIdentifier": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "pattern": "^Buffer$" }
      }
    },
    "BooleanSchemaTypeIdentifier": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "pattern": "^Boolean$" }
      }
    },
    "MixedSchemaTypeIdentifier": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "pattern": "^Mixed$" }
      }
    },
    "ObjectIdSchemaTypeIdentifier": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "pattern": "^ObjectId$" }
      }
    },
    "ArraySchemaTypeIdentifier": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "pattern": "^Array$" }
      }
    },
    "EnumProperty": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Property" }
      ],
      "properties": {
        "key": { "$ref": "#/definitions/EnumIdentifier" },
        "value": { "$ref": "#/definitions/StringArrayExpression" }
      }
    },
    "EnumIdentifier": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "pattern": "^enum$" }
      }
    },
    "StringArrayExpression": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/ArrayExpression" }
      ],
      "properties": {
        "elements": {
          "type": "array",
          "items" { "$ref": "#/definitions/StringLiteral" }
        }
      }
    },
    "StringLiteral": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Literal" }
      ],
      "properties": {
        "value": { "type": "string" }
      }
    },
    "LowercaseProperty": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Property" }
      ],
      "properties": {
        "key": { "$ref": "#/definitions/LowercaseIdentifier" },
        "value": { "$ref": "#/definitions/BooleanLiteral" }
      }
    },
    "LowercaseIdentifier": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "pattern": "^lowercase$" }
      }
    },
    "BooleanLiteral": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Literal" }
      ],
      "properties": {
        "value": { "type": "boolean" }
      },
      "default": false
    },
    "UppercaseProperty": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Property" }
      ],
      "properties": {
        "key": { "$ref": "#/definitions/UppercaseIdentifier" },
        "value": { "$ref": "#/definitions/BooleanLiteral" }
      }
    },
    "UppercaseIdentifier": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "pattern": "^uppercase$" }
      }
    },
    "TrimProperty": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Property" }
      ],
      "properties": {
        "key": { "$ref": "#/definitions/TrimIdentifier" },
        "value": { "$ref": "#/definitions/BooleanLiteral" }
      }
    },
    "TrimIdentifier": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "pattern": "^trim$" }
      }
    },
    "MatchProperty": {
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Property" }
      ],
      "properties": {
        "key": { "$ref": "#/definitions/TrimIdentifier" },
        "value": { 
          "oneOf": [
            { "$ref": "#/definitions/StringLiteral" },
            { "$ref": "#/definitions/MatchArrayExpression" }  
          ]
        }
      }
    },
    "MatchIdentifier": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/Identifier" }
      ],
      "properties": {
        "name": { "type": "string", "pattern": "^match$" }
      }
    },
    "MatchArrayExpression": {
      "type": "object",
      "allOf": [
        { "$ref": "http://esschema.org/esschema#/definitions/ArrayExpression" }
      ],
      "properties": {
        "elements": {
          "type": "array",
          "items": [
            { "$ref": "#/definitions/StringLiteral" },
            { "$ref": "#/definitions/StringLiteral" }
          ]
        }
      }
    },
    "NumberSchemaTypeObjectExpression": { "type": "object" },
    "DateSchemaTypeObjectExpression": { "type": "object" },
    "BufferSchemaTypeObjectExpression": { "type": "object" },
    "BooleanSchemaTypeObjectExpression": { "type": "object" },
    "MixedSchemaTypeObjectExpression": { "type": "object" },
    "ObjectSchemaTypeObjectExpression": { "type": "object" },
    "ArraySchemaTypeObjectExpression": { "type": "object" }
  },
  "type": "object",
  "allOf": [
    { "$ref": "#/definitions/MongooseModule" }
  ]
}
